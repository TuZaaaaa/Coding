# 可靠数据传输
- RDT: Reliable Data Transfer

## RDT 1.0
- 下层信道完全可靠
  - 不出错、不丢失
- 发送方和接收方的 FSM
  - 发送方：将数据发送至下层信道 
  - 接收方：从下层信道接收数据

## RDT 2.0
- 下层信道可能出错
  - 使用校验和检测比特出错
- 问题：如何从差错中恢复
  - 确认 ACK
  - 否定确认 NAK
    - 重传
- 新机制
  - 使用差错控制编码进行差错检测

## RDT 2.1
- 接收方处理出错的 ACK/NAK

## RDT 2.2
- NAK free
- 无需 NAK，当前分组的反向确认用前面分组的正向确认表示

## RDT 3.0
- 设置合理的超时时间
- 链路容量较大的情况下，性能很差
- 流水线协议
  - 允许发送方未得到确认时一次发送多个分组
  - 增加序号范围
  - 发送/接收方要有缓冲区
    - 发送方：未得到确认，需要重传
    - 接收方：上层用户取用数据速率 != 接收的数据速率，数据可能乱序，排序交付（保证可靠性）
  - 两种通用的流水线协议
    - 回退N步（GBN）Go-Back-N
    - 选择重传（SR）Selective Repeat

## 通用：滑动窗口协议
- slide window
- SW 分类
  - SW=1, RW=1, S-W stop&wait
  - SW>1, RW=1, GBN Go-Back-N
  - SW>1, RW>1, SR Selective Repeat
- 发送缓冲区
  - 形式：内存中的区域，落入缓冲区的分组可以发送
  - 功能：用于存储已发送，但是没有得到确认的分组
  - 必要性：需要重发时可用
- 缓冲区大小：一次最多可以发送多少未确认的分组
  - 停止等待协议=1
  - 流水线协议>1，不能太大，链路利用率不能超过 100%
- 分组
  - 未发送：落入发送缓冲区的分组，可以连续发送出去
  - 已发送、等待对方确认：得到确认后删除
- 发送窗口：发送缓冲区内容的一个范围
  - 最大值 <= 缓冲区的值
  - 一开始：没有发送任何一个分组
    - 后沿=前沿
    - 之前为发送窗口的尺寸=0
  - 每发送一个分组，前沿前移一个单位
  - 前沿移动
    - 极限：不能够超过发送缓冲区
  - 后沿移动
    - 条件：收到老分组的确认
    - 结果：发送缓冲区罩住新的分组，来了分组可以发送
    - 移动的极限：不能够超过前沿
- 接收窗口：接收缓冲区
  - 用于控制哪些分组可以接收
    - 序号落入接收窗口后，才允许接收
    - 否则丢弃
  - 滑动
    - 低序号分组到来时滑动，高序号分组乱序到来时，缓存但不交付，不滑动
  - 发送确认
    - 尺寸 Wr=1, 顺序接收 累计确认(cumulative ack) GBN
    - 尺寸 Wr>1, 乱序接收 非累计确认(individual ack) SR
- 异常情况
  - GBN
    - 超时重发：会将发送窗口中所有分组发送出去
  - SR
    - 超时重发：将超时的分组重发
- GBN vs SR 总结
  - GBN
    - 简单，占用资源少，适合出错率低的场景
    - 出错代价大
  - SR
    - 复杂，占用资源多（多个缓存单元），适合链路容量大（延迟大、带宽大）
