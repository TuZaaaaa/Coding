# 分组延时、丢失和吞吐量

## 分组丢失和延时是如何发生的？

- 在路由器缓冲区的分组队列
  - **分组到达链路的速率超过了链路输出的能力**
  - 分组等待排到队头，被传输

## 四种分组延时

- 节点处理延时 processing
  - 检查 bit 级差错
  - 检查分组首部和决定将分组导向何处
- 排队延时 queueing
  - 在输出链路上等待传输的时间
  - 依赖于路由器的拥塞控制
- 传输延时 transmission
  - R=链路带宽(bps)
  - L=分组长度(bits)
  - 将分组发送到链路上的时间=L/R
  - 存储转发延时
- 传播延时 propagation
  - d=物理链路的长度
  - s=在媒体上的传播速度($~2*10^8m/sec$)
  - 传播延时=d/s

### 节点延时
> $$d_{nodal} = d_{proc} + d_{queue} + d_{trans} + d_{prop}$$
- $d_{proc}$ 处理延时
  - 通常是微妙数量级或更少
- $d_{queue}$ 排队延时
  - 取决于拥塞程度
- $d_{trans}$ 传输延时
  - L/R，对低速率的链路而言很大（如拨号），通常为微秒级到毫秒级
- $d_{prop}$ 传播延时
  - 几微秒到几百毫秒

### 排队延时

- R=链路带宽(bps)
- L=分组长度(bits)
- a=分组到达队列的平均速率(pkt/s)
- **流量强度：La/R**
  - La/R ~ 0：平均排队延时很小
  - La/R -> 1：平均排队延时变得很大
  - La/R > 1：分组到达链路的速率超过了从该队列输出的速率，平均排队延时将趋向无穷大
  - **设计系统时，流量强度不能大于1**

## Internet 的延时和路由

- Traceroute: 提供从源端，经过路由器，到目标端的延时测量
- For all i:
  - 沿着目标端路机灵，向每个路由器发送 3 个探测分组
  - 路由器 i 将向发送方返回一个分组
  - 发送方对发送和回复之间间隔计时


## 分组丢失
- 链路的队列缓冲区容量有限
- 当分组到达一个满的队列时，该分组将会丢失
- 丢失的分组可能会被前一个节点或源端系统重传，或根本不重传

## 吞吐量
> 在源端和目标端之间传输的速率（数据量/单位时间）
- 瞬间吞吐量：在一个时间点的速率
- 平均吞吐量：在一个长时间内平均值
- 端到端平均吞吐：min{R1, R2, ..., Rn} 取决于最小的带宽
- 瓶颈链路：端到端的路径上，限制端到端的吞吐的链路


## 实际场景
- 假设有 10 对 client/server 经过一个 R 链路
- 端到端的吞吐：min{Rc, Rs, R/10}
- 实际上：Rc/Rs 常常为瓶颈链路
